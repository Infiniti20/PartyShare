{
  "version": 3,
  "sources": ["../app/schedule.ts"],
  "sourcesContent": ["import lt from \"long-timeout\";\r\n\r\nlet actions: {[action: string]: Function }= {};\r\n\r\ninterface Job {\r\n  date: number;\r\n  name: string;\r\n  args: any[];\r\n  passed: boolean;\r\n}\r\n\r\n\r\nfunction addAction(name: string, action: Function): Function {\r\n  actions[name] = action;\r\n  return action;\r\n}\r\n\r\nfunction addEditAction(func: Function): Function {\r\n  actions[\"edit\"] = func;\r\n  return func;\r\n}\r\n\r\nfunction scheduleJob(func: Function, args: any[], date: Date) {\r\n  console.log(actions)\r\n  let delay = calculateDelay(date);\r\n  console.log(delay)\r\n  lt.setTimeout(() => {\r\n    console.log(\"executed\")\r\n    func(...args);\r\n  }, delay);\r\n}\r\n\r\nfunction calculateDelay(targetDate: Date): number {\r\n  let unixTargetDate = targetDate.getTime();\r\n  let unixDate = new Date().getTime();\r\n\r\n  let delay = Math.max(unixTargetDate - unixDate, 0);\r\n\r\n  return delay;\r\n}\r\n\r\nasync function loadJobs(jobs: { [job: string]: Job }) {\r\n  let date = new Date().getTime();\r\n  let ids = Object.keys(jobs);\r\n  const jobList = Object.values(jobs);\r\n\r\n  for (let i = 0; i < jobList.length; i++) {\r\n    let job = jobList[i];\r\n    console.log(date, job.date)\r\n    if (date > job.date) {\r\n      if (job.passed == false) {\r\n        actions[job.name](...job.args);\r\n        await actions[\"edit\"](ids[i]);\r\n      }\r\n      continue;\r\n    }\r\n\r\n    scheduleJob(actions[job.name], job.args, new Date(job.date));\r\n  }\r\n}\r\n\r\nexport { addAction, addEditAction, loadJobs, scheduleJob, Job};\r\n"],
  "mappings": "mlBAAA,wFAAe,2BAEX,EAAwC,GAU5C,WAAmB,EAAc,EAA4B,CAC3D,SAAQ,GAAQ,EACT,EAGT,WAAuB,EAA0B,CAC/C,SAAQ,KAAU,EACX,EAGT,WAAqB,EAAgB,EAAa,EAAY,CAC5D,QAAQ,IAAI,GACZ,GAAI,GAAQ,EAAe,GAC3B,QAAQ,IAAI,GACZ,UAAG,WAAW,IAAM,CAClB,QAAQ,IAAI,YACZ,EAAK,GAAG,IACP,GAGL,WAAwB,EAA0B,CAChD,GAAI,GAAiB,EAAW,UAC5B,EAAW,GAAI,QAAO,UAI1B,MAFY,MAAK,IAAI,EAAiB,EAAU,GAKlD,iBAAwB,EAA8B,CACpD,GAAI,GAAO,GAAI,QAAO,UAClB,EAAM,OAAO,KAAK,GAChB,EAAU,OAAO,OAAO,GAE9B,OAAS,GAAI,EAAG,EAAI,EAAQ,OAAQ,IAAK,CACvC,GAAI,GAAM,EAAQ,GAElB,GADA,QAAQ,IAAI,EAAM,EAAI,MAClB,EAAO,EAAI,KAAM,CACnB,AAAI,EAAI,QAAU,IAChB,GAAQ,EAAI,MAAM,GAAG,EAAI,MACzB,KAAM,GAAQ,KAAQ,EAAI,KAE5B,SAGF,EAAY,EAAQ,EAAI,MAAO,EAAI,KAAM,GAAI,MAAK,EAAI",
  "names": []
}
