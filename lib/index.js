var b=Object.create;var p=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var D=Object.getPrototypeOf,S=Object.prototype.hasOwnProperty;var I=r=>p(r,"__esModule",{value:!0});var L=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!S.call(r,n)&&n!=="default"&&p(r,n,{get:()=>e[n],enumerable:!(t=k(e,n))||t.enumerable});return r},c=r=>L(I(p(r!=null?b(D(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var K=require("crypto"),R=require("fs"),h={computeHash:function(r){return K.createHash("sha256").update(r).digest("base64")},generateUUID:function(){return"xxxxxxxx-xxxx-4xxxx-xxx-x".replace(/[xy]/g,function(r){var e=Math.random()*16|0,t=r=="x"?e:e&3|8;return t.toString(16)})},filter:function(r,e,t){if(!e.originalname.match(/\.(jpg|JPG|jpeg|JPEG|png|PNG)$/))return r.fileValidationError="Only image files are allowed",t(new Error("Only image files are allowed"),!1);t(null,!0)},getExt:function(r){var e=r.lastIndexOf(".");return e<0?"":r.substr(e)},replaceValues:function(r,e){var r=r.replace(/\[\w*\]/g,function(t,n){return e[t.slice(1,-1)]||t});return r},getFileStream:async function(r){let e=R.createReadStream(r);return await new Promise(function(o,a){e.on("data",d=>o(d.toString())),e.on("error",a)})}};var y=c(require("dotenv"));var g=c(require("sqlite3"));g.default.verbose();var m=class{constructor(e){this._db=new g.default.Database(e),this._db.run("PRAGMA journal_mode = WAL")}run(e,...t){return new Promise((n,o)=>{this._db.run(e,t.params,function(a){a?o(a):n(this)})})}get(e,...t){return new Promise((n,o)=>{this._db.get(e,t.params,(a,d)=>{a?o(a):n(d)})})}all(e,...t){return new Promise((n,o)=>{this._db.all(e,t.params,(a,d)=>{a?o(a):n(d)})})}exec(e,...t){return new Promise((n,o)=>{this._db.exec(e,a=>{a?o(a):n(this)})})}};var l=c(require("express")),w=c(require("cookie-parser")),u=c(require("firebase-admin"));var U="service_account",N="partyshare-47d15",C="e25d712d9968cb22e26c6e479eab353491fd2f44",P=`-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCrEnS10v+DHpno
sbEby4fWlgcjUNFhLkdy+MC/0tEL4lQSIwxVePFWL0ZBpwb+trfnZ7fn2khe9DAx
13bFHVMhKR2Lbgny0e/Ea97NRRmutGdBA33KSKEYjRR4MfGfe3/Cgu6K4dGf8+Lc
sKQ8LByA64UbmnKyDDM2DLG2WtH3+uJ8ALdpDbA2w0NQ3pi3YDdI207EZFJOJVpD
CE/L8qSkqjyP8VWAUstj3H+B2j/Ea5zH8RKtQIzPrwBewdn8PJU1QuKuN700anXh
VqzUJwzEjQamMrx+38h8Q6XBxUw357bUuC389JCiquM0VCnbVfdyEwmD+0eUZ3nl
Ku4MdRRfAgMBAAECggEACCACRw3UcOfSgN4fqVBLYq0RfbiS7pNXdWXMfHqIzzsF
VISG9hrzwMInYMA2xtZAJHolSUUcIYEQ4O0jiPfRlkZGTvRU/fbBSopNCgwkIiC+
CV/JvlfLaZ0ZwckCztj7bRjxjMsY57NFAnJT+pT7GEHCEAOP5augAGCDTZlBVmO8
zjPrHQIBrJDaArbylayhb29XoW25oMsaDGOp1Hlx2Fq3wK7txtgIaD7wSlZtsQB6
FUFB03+kiY9TNTpwp1cbxriTtRgu9RKvyQ0Rvk0TGyUdc0brrHnq2U4ot1VJFj1e
n1WT9iHR4Ovx1qC3Al8MPnBrZ+PraVmN5T0CawdsEQKBgQDipCVTBv0OpkS1E8XI
f+KviQueU893NZUruLJAkHFMJYu6dn//pIxGRw4chVwmWIuS2ZhHsztjW2giznEO
92WE8oFAneb9THQDbVwFfOfuY4GdEULoUrNLhFKK1dfise2GVmp3UgQhENcSwoZR
/Z6s9yaDXNK75taVR055SNObLQKBgQDBO4hhnsduoqeTX52dHn9psnqBfzgbUFHh
fdvTdOqzv++6yaoL22hGQTZMuul0Gg4ryHV9VJZ1L0/1epO/9hxGxom58RJLWCxw
SAuH3ZEjS7KYGZgh+IDDGtcdNhykENLOPEWoG1uukBZerjxa3+eLmvHa8vYMzqiW
MySV4NA1OwKBgQDNJt5uUIYii5jn/DTtL+3HDRuKPr0uYD9eKzqXPOiBj/7yUy+7
/XvIZas9X+4w+7ejvvmb9X6NioEx+ILYlFK9zDH5hrU/lcPyEjzY7t6WqFX8ElLp
L2sCsY1yBO39Uyf5kSGgTopUUAUPAyxI7XWDhdjD0fMjiWm2CKzdFnINJQKBgBL9
r9ywRzd3YvLX/dyYR7tyoBmkEDaXAUUhIn64yexam8wGz+CUcr4c4KJP6GvRt7zT
2cA0lQj1Wm1s26KNJKBMGPMeX0bqZouuePukagRHB0ltkoccLkN+ms+zJsN1J9K/
F7V64trYLGqnwyTHRrFwy/5RzJ7bnLQOWLUmQDBLAoGBALPU5afAQEacP1C8KbVM
J9yDEFpHudwgC8c6MnCK0IIpaS4IA+r8f74q/QswyeANyYX9FggdAp+SM1aDOAcQ
fY0+gOptWoB7NuGfk/rhs6ezo8ivLtXWDKzA44DS0K9NNcf1a+ysP6I0mVws5mA8
QEoYzPmkP+BNjhnXqBg5ykMx
-----END PRIVATE KEY-----
`,T="firebase-adminsdk-dx0dk@partyshare-47d15.iam.gserviceaccount.com",G="115450043492170133553",q="https://accounts.google.com/o/oauth2/auth",j="https://oauth2.googleapis.com/token",M="https://www.googleapis.com/oauth2/v1/certs",Q="https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-dx0dk%40partyshare-47d15.iam.gserviceaccount.com",f={type:U,project_id:N,private_key_id:C,private_key:P,client_email:T,client_id:G,auth_uri:q,token_uri:j,auth_provider_x509_cert_url:M,client_x509_cert_url:Q};var A=c(require("stripe"));y.default.config();var x="http://partyshare.ca",v=new m("database/partyshare.db");async function V(){v.exec("CREATE TABLE IF NOT EXISTS accounts ( id varchar(25) PRIMARY KEY, name varchar(100), email varchar(80), authID varchar(28), location varchar(250) ) "),v.exec("CREATE TABLE IF NOT EXISTS products ( name varchar(75), id varchar(25), accountID varchar(25), imageURL varchar(55), category varchar(12), desc varchar(250), info varchar(200), quantity int, price int, deposit int )")}V();var s=(0,l.default)();s.use(l.default.json());s.use(l.default.urlencoded({extended:!0}));s.use((0,w.default)());u.default.initializeApp({credential:u.default.credential.cert(f),storageBucket:process.env.BUCKET_URL});var X=u.default.firestore(),E=new A.default(process.env.StripeSK,{apiVersion:"2020-08-27"});console.log(process.env.StripeSK);s.set("view engine","ejs");s.use("/views",l.default.static("views"));s.get("/",async(r,e)=>{e.render("homepage/index")});s.get("/vendor-login",async(r,e)=>{e.render("vendor-login/index")});s.get("/accounts/create",async(r,e)=>{let t=h.computeHash(Math.random().toString()),n=await E.accounts.create({type:"express",country:"CA",business_type:"individual"}),o=await E.accountLinks.create({account:n.id,refresh_url:`${x}/accounts/create`,return_url:`${x}/accounts/create/${t}`,type:"account_onboarding"});e.cookie("stripeID",n.id),e.redirect(o.url)});s.get("/accounts/create/:hash",async(r,e)=>{e.render("create-account/index")});s.post("/accounts/login",async(r,e)=>{let t=r.body.idToken,n=60*60*24*5*1e3,o=await u.default.auth().createSessionCookie(t,{expiresIn:n}),a={maxAge:n};e.cookie("session",o,a),e.end(JSON.stringify({status:"success"}))});s.get("/verify",async(r,e)=>{let t=r.cookies.session,n=await u.default.auth().verifySessionCookie(t);console.log(n),e.send("complete")});s.listen(80,()=>{console.log("Server running..."),console.log("")});
//# sourceMappingURL=index.js.map
